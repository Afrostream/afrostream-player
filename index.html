<!doctype html >
<html data-cast-api-enabled="true">
<head>
  <meta charset="utf-8">
  <title>Afrostream player based on videojs Demo</title>
  <link href="/dist/afrostream-player.css" rel="stylesheet">
  <link href="/node_modules/videojs-chromecast/dist/videojs-chromecast.css" rel="stylesheet">
  <style>

    button {
      margin: 1em;
      width: 10em;
    }

    .autoadvance-group {
      margin: 1em;
    }

    .autoadvance-group label {
      margin: 10px;
    }
  </style>
  <!-- chromecast sdk -->
  <script async src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
</head>
<body>
<video class="video-js vjs-afrostream-skin" controls width="640px" height="360px"
       poster="http://content.bitsontherun.com/thumbs/3XnJSIm4-480.jpg">
  <!--<source-->
  <!--src="http://dash.edgesuite.net/akamai/test/caption_test/ElephantsDream/elephants_dream_480p_heaac5_1.mpd"-->
  <!--type="application/dash+xml"/>-->
  <!--<source src="https://hw.cdn.afrostream.net/live/bet.isml/bet.mpd"-->
  <!--type="application/dash+xml"/>-->
  <!--<source-->
  <!--src="http://dash.edgesuite.net/digitalprimates/fraunhofer/480p_video/mps_5_1_with_video/Sintel/sintel_480p_mps5_1.mpd"-->
  <!--type="application/dash+xml"/>-->
  <!--<source-->
  <!--src="https://hw.cdn.afrostream.net/vod/WILDWILDWEST_FILMLM_16020931/3d14bbf03db5f0b5.ism/3d14bbf03db5f0b5.mpd"-->
  <!--type="application/dash+xml"/>-->
  <!--<track kind="captions" src="./node_modules/video.js/dist/examples/shared/example-captions.vtt" srclang="fr"-->
  <!--label="Francais" default/>-->
  <!--&lt;!&ndash;Tracks need an ending tag thanks to IE9&ndash;&gt;-->
  <!--<track kind="captions" src="./node_modules/video.js/dist/examples/shared/example-captions.vtt" srclang="en"-->
  <!--label="English"/>-->
  <!--<source-->
  <!--src="https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"-->
  <!--type="application/x-mpegURL"/>-->
</video>
<div id="graphWrapper" class="row">
  <h2>Video Bitrate Graph</h2>
  <canvas id="_chart" width="640" height="360"></canvas>
</div>
<ul>
  <li><a href="/test/">Run unit tests in browser.</a></li>
</ul>
<!--<script src="/node_modules/video.js/dist/video.js"></script>-->
<script src="/libs/video.js"></script>
<script> window.dashjs = {skipAutoCreate: true}; </script>
<script src="/node_modules/dashjs/dist/dash.all.debug.js"></script>
<script src="/node_modules/smoothie/smoothie.js"></script>
<script src="/dist/afrostream-player.js"></script>
<script src="//code.jquery.com/jquery-2.1.4.js"></script>
<script>

  var player = videojs(document.querySelector('video'), {
    autoplay: true,
    sources: [
      {
        src: "https://origin.cdn.afrostream.net/vod/HANCOCK_240_25_ProRes422_FRA_ENG_HD_STEREO/b10bbcc21f1b8988.ism/b10bbcc21f1b8988.mpd",
        type: "application/dash+xml"
      },
//      {
//        src: "https://origin.cdn.afrostream.net/vod/HANCOCK_240_25_ProRes422_FRA_ENG_HD_STEREO/b10bbcc21f1b8988.ism/master.m3u8",
//        type: "application/vnd.apple.mpegurl"
//      },
      {
        src: "https://hw.cdn.afrostream.net/vod/24hourlovebis/d4eed726882a4be3.ism/d4eed726882a4be3.mpd",
        type: "application/dash+xml"
      },
      {
        src: "https://origin.cdn.afrostream.net/vod/24hourlovebis/d4eed726882a4be3.ism/master.m3u8",
        type: "application/vnd.apple.mpegurl"
      }
    ],
//    aspectRatio: "640:167",
    controlBar: {
      volumeMenuButton: {
        inline: false
      },
      nextVideoButton: {
        title: 'Dummy episode 2',
        poster: 'http://fakeimg.pl/150'
      }
    },
    metrics: {
      "user_id": 34
    },
    dashas: {
      swf: './dashas.swf'
    },
    chromecast: {},
    techOrder: ["dash", "html5", "dashas"]
  }).ready(function () {
    var player = this;

    var smoothie = new SmoothieChart({
      millisPerPixel: 20,
      interpolation: 'bezier',
      grid: {strokeStyle: 'rgba(119,119,119,0.02)'},
      maxValue: 5000,
      minValue: -50
    });

    var audioSerie = new TimeSeries();
    var videoSerie = new TimeSeries();
    var p2pSerie = new TimeSeries();

    smoothie.addTimeSeries(audioSerie, {
      strokeStyle: 'rgb(100,255,255)',
      lineWidth: 1
    });

    smoothie.addTimeSeries(videoSerie, {
      strokeStyle: '#00ff00',
      lineWidth: 1
    })

    smoothie.addTimeSeries(p2pSerie, {
      strokeStyle: '#0000FF',
      lineWidth: 1
    });

    var chart = $('#_chart')[0];

    player.on('loadedmetadata', function () {
      chart.width = player.width();
    });

    smoothie.streamTo(chart, 1000);

    setInterval(function () {
      var statistics = player.getPlaybackStatistics();
      var dlAudioBitrate = statistics.audio.bandwidth;
      var dlVidBitrate = statistics.video.bandwidth;
      var p2pRatio = statistics.p2pweb.p2pRatio;
      var chunksFromCDN = statistics.p2pweb.chunksFromCDN;
      var chunksFromP2P = statistics.p2pweb.chunksFromP2P;
      var chunksSent = statistics.p2pweb.chunksSent;
      var bufferLength = statistics.p2pweb.bufferLength;
      var swarmSize = statistics.p2pweb.swarmSize;
      var startupTime = statistics.p2pweb.startupTime;
//      document.getElementById('version').innerHTML = videojs.CDN_VERSION;
//      document.getElementById('resolution').innerHTML = player.width() + ' x ' + player.height();
//      document.getElementById('audioBuffer').innerHTML = statistics.audio.bufferLength;
//      document.getElementById('videoBuffer').innerHTML = statistics.video.bufferLength;
//      document.getElementById('dlAudioBitrate').innerHTML = dlAudioBitrate;
//      document.getElementById('dlVideoBitrate').innerHTML = dlVidBitrate;
//      //P2P
//      document.getElementById('p2pWebRatio').innerHTML = p2pRatio;
//      document.getElementById('chunksFromCDN').innerHTML = chunksFromCDN;
//      document.getElementById('chunksFromP2P').innerHTML = chunksFromP2P;
//      document.getElementById('chunksSent').innerHTML = chunksSent;
//      document.getElementById('bufferLength').innerHTML = bufferLength;
//      document.getElementById('swarmSize').innerHTML = swarmSize;
//      document.getElementById('startupTime').innerHTML = startupTime;
      var now = new Date().getTime();
      audioSerie.append(now, dlAudioBitrate);
      videoSerie.append(now, dlVidBitrate);
      p2pSerie.append(now, p2pRatio);
    }, 500);
  });

  try {
    // try on ios
    player.volume(0);
  } catch (e) {
  }

</script>
</body>
</html>
